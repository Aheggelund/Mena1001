#!/usr/bin/python
import matplotlib.pyplot as plt
import numpy as np
from sklearn.linear_model import LinearRegression
import math

global file_name
global U_0

# Skriv inn navnet på datafilen, pass på at denne ligger i samme mappe som koden (hvis ikke kan du skrive full path
file_name = "data_mena1001_lab1a.txt"

# Sett her verdien for startspenningen målt i øvelse 1a - del 4
U_0 = 30 #enhet mV

# Denne funksjonen regner ut verdien for uttrykket i ligning 8 og plotter
# Det utførs også en lineær regresjon og stigningstallet spyttes ut
def Plot(x_array, y_array):
    
    for i in range(len(x_array)):
        x_array[i] = int(x_array[i])
        y_array[i] = math.log(int(y_array[i])/U_0)
    X = np.asarray(x_array).reshape(-1,1)
    Y = np.asarray(y_array).reshape(-1,1)
    print(X)
    model = LinearRegression()
    model.fit(X, Y)
    Y_pred = model.predict(X)
    stigningstall = model.coef_
    print(stigningstall)
    plt.scatter(X, Y)
    plt.xlabel("tid [s]")
    plt.ylabel("ln(U/U_0)")
    plt.plot(X, Y_pred, 'r')
    plt.show()
    
def Main():

    U = []
    T = []
    cnt = 1
    try: 
        with open(str(file_name),"r") as f:

#            print(type(line))
            for cnt, line in enumerate(f):

                print("Temperatur {}: {}".format(cnt, line.split(',')[0]),
                      "Spenning {}: {}".format(cnt, line.split(',')[1]))
                U.append(line.split(',')[0])
                T.append(line.split(',')[1])
                cnt += 1
                
    except FileNotFoundError:
        print("Fant ikke filen, har du skrevet rett navn/path?")

    Plot(U,T)
    
#Plot(voltage_array, temperature_array)

Main()
